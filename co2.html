<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Симулятор уровня CO₂</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* === ОБЩИЕ СТИЛИ === */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #001a33, #003366);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        a {
            text-decoration: none;
        }

        /* === ВЕРХНЯЯ ПАНЕЛЬ === */
        .top-bar {
            background-color: #000;
            padding: 12px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            width: 100%;
            box-sizing: border-box;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
        }

        .logo a {
            color: white;
        }

        .main-nav {
            display: flex;
            gap: 30px;
        }

        .main-nav a {
            font-size: 16px;
            color: white;
            font-weight: bold;
        }

        /* === ПОДМЕНЮ === */
        .submenu {
            background: #222;
            display: flex;
            justify-content: center;
            padding: 12px 0;
            gap: 30px;
            border-bottom: 1px solid #333;
            width: 100%;
        }

        .submenu a {
            font-size: 16px;
            font-weight: bold;
            color: white;
        }

        /* === ОСНОВНОЙ КОНТЕНТ === */
        .container {
            max-width: 900px;
            width: 90%;
            margin: 30px auto;
            padding: 30px;
            background: rgba(0, 20, 40, 0.7);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            color: #4fc3f7;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            color: #b3e5fc;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .image-container {
            margin: 20px 0;
            min-height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            position: relative;
        }

        #co2Image {
            max-width: 100%;
            max-height: 500px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            transition: opacity 0.3s ease;
        }

        .loading {
            position: absolute;
            color: #b3e5fc;
            font-size: 18px;
        }

        .slider-container {
            width: 100%;
            margin: 30px 0;
        }

        .date-display {
            font-size: 28px;
            font-weight: bold;
            color: #4fc3f7;
            margin: 15px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .co2-level {
            font-size: 16px;
            color: #b3e5fc;
            display: flex;
            gap: 20px;
        }

        .co2-level span {
            background: rgba(0, 60, 120, 0.3);
            padding: 5px 10px;
            border-radius: 5px;
            border-left: 2px solid #2196f3;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            background: linear-gradient(90deg, #0d47a1, #2196f3);
            border-radius: 5px;
            outline: none;
            opacity: 0.9;
            transition: opacity .2s;
        }

        input[type="range"]:hover {
            opacity: 1;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: transform .1s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        .year-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            color: #b3e5fc;
            font-size: 14px;
        }

        .info-panel {
            margin-top: 30px;
            padding: 15px;
            background: rgba(0, 60, 120, 0.3);
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }
        
        .data-highlight {
            color: #fc3d21;
            font-weight: bold;
        }
        
        canvas {
            margin-top: 40px;
            background: #fff;
            border-radius: 12px;
        }

        @media (max-width: 768px) {
            .date-display {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .co2-level {
                flex-direction: column;
                gap: 5px;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Верхняя панель -->
    <div class="top-bar">
        <div class="logo"><a href="index.html">Главная</a></div>
        <nav class="main-nav">
            <a href="primer.html">Карта</a>
            <a href="primer.html">Диаграммы</a>
            <a href="primer.html">Источники</a>
        </nav>
    </div>

    <!-- Подменю -->
    <nav class="submenu">
        <a href="ПОТЕПЛ.html">Глобальное потепление</a>
        <a href="море.html">Уровень моря</a>
        <a href="тепл море.html">Потепление океана</a>
        <a href="co2.html">Углекислый газ</a>
        <a href="лед.html">Ледяные щиты</a>
    </nav>

    <!-- Основной контейнер -->
    <div class="container">
        <h1>Симулятор уровня CO₂</h1>
        <div class="subtitle">Наблюдайте за глобальными изменениями концентрации CO₂ с сентября 2002 по ноябрь 2022 года (данные NASA)</div>
        
        <div class="image-container">
            <div class="loading" id="loadingIndicator">Загрузка изображений...</div>
            <img id="co2Image" src="img3/co2_2002_9_0001_720x360.jpg" alt="Карта концентрации CO₂" style="opacity: 0;">
        </div>
        
        <div class="slider-container">
            <div class="date-display">
                <div>Дата: <span id="dateValue">Сентябрь 2002</span></div>
                <div class="co2-level">
                    <span id="co2Value">Уровень CO₂: 370 ppm</span>
                    <span id="changeFromStart">Δ с 2002 года: 0 ppm</span>
                </div>
            </div>
            
            <input 
                type="range" 
                id="dateSlider"
                min="1" 
                max="243" 
                value="1" 
                step="1"
                oninput="updateDate(this.value)"
                disabled>
            
            <div class="year-labels">
                <span>Сентябрь 2002</span>
                <span>Ноябрь 2022</span>
            </div>
        </div>
        
        <!-- График CO₂ -->
        <canvas id="co2Chart" width="800" height="300"></canvas>
        
        <!-- Блок ключевых фактов -->
        <div class="info-panel">
            <h3>Ключевые факты о CO₂:</h3>
            <p>• <span class="data-highlight">2023 год</span>: Концентрация CO₂ достигла <span class="data-highlight">419 ppm</span> - самого высокого уровня за 2 миллиона лет</p>
            <p>• <span class="data-highlight">Скорость роста</span>: Уровень CO₂ увеличивается на ~2.5 ppm ежегодно</p>
            <p>• <span class="data-highlight">Доиндустриальный уровень</span>: ~280 ppm (до 1750 года)</p>
            <p>• <span class="data-highlight">Основные источники</span>: Сжигание ископаемого топлива (87%), вырубка лесов (13%)</p>
            <p>• <span class="data-highlight">Эффект потепления</span>: CO₂ ответственен за ~50% парникового эффекта</p>
            <p>Данные: NASA Global Climate Change, NOAA, Scripps Institution of Oceanography</p>
        </div>
    </div>

    <script>
        // Генерация данных с сентября 2002 по ноябрь 2022 (243 месяца)
        function generateDateData() {
            const dateData = [];
            const months = ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 
                          'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'];
            
            let index = 0;
            const startYear = 2002;
            const endYear = 2022;
            const startCO2 = 370;
            const endCO2 = 417;
            const co2Step = (endCO2 - startCO2) / 242;
            
            for (let year = startYear; year <= endYear; year++) {
                const startMonth = year === 2002 ? 8 : 0; // Начинаем с сентября (8) для 2002 года
                const endMonth = year === 2022 ? 10 : 11; // Заканчиваем ноябрем (10) для 2022 года
                
                for (let monthIdx = startMonth; monthIdx <= endMonth; monthIdx++) {
                    index++;
                    const imgNum = String(index).padStart(4, '0');
                    
                    // Определяем путь к изображению
                    let imgPath;
                    if (index <= 100) {
                        imgPath = `img3/co2_${year}_${monthIdx+1}_${imgNum}_720x360.jpg`;
                    } else if (index <= 200) {
                        imgPath = `img4/co2_${year}_${monthIdx+1}_${imgNum}_720x360.jpg`;
                    } else {
                        imgPath = `img5/co2_${year}_${monthIdx+1}_${imgNum}_720x360.jpg`;
                    }
                    
                    // Расчет уровня CO₂ (можно заменить на реальные данные)
                    const co2 = Math.round(startCO2 + (co2Step * (index - 1)) * 10) / 10;
                    
                    dateData.push({
                        year: year,
                        month: months[monthIdx],
                        co2: co2,
                        imgPath: imgPath,
                        index: index
                    });
                }
            }
            
            return dateData;
        }
        
        const dateData = generateDateData();
        const startCO2 = dateData[0].co2;
        const imageCache = {};
        let isPreloading = false;
        let currentImageIndex = 1;
        
        // Функция для предзагрузки изображений
        function preloadImages() {
            if (isPreloading) return;
            
            isPreloading = true;
            const loadingIndicator = document.getElementById('loadingIndicator');
            const totalImages = dateData.length;
            let loadedCount = 0;
            
            loadingIndicator.textContent = `Загрузка изображений: 0/${totalImages}`;
            
            dateData.forEach(data => {
                const img = new Image();
                img.src = data.imgPath;
                
                img.onload = () => {
                    imageCache[data.index] = img;
                    loadedCount++;
                    loadingIndicator.textContent = `Загрузка изображений: ${loadedCount}/${totalImages}`;
                    
                    // Когда все изображения загружены
                    if (loadedCount === totalImages) {
                        loadingIndicator.style.display = 'none';
                        document.getElementById('co2Image').style.opacity = '1';
                        document.getElementById('dateSlider').disabled = false;
                        
                        // Показать первое изображение
                        updateDate(1);
                    }
                };
                
                img.onerror = () => {
                    console.error('Ошибка загрузки изображения:', data.imgPath);
                    loadedCount++;
                    if (loadedCount === totalImages) {
                        loadingIndicator.style.display = 'none';
                        document.getElementById('co2Image').style.opacity = '1';
                        document.getElementById('dateSlider').disabled = false;
                        updateDate(1);
                    }
                };
            });
        }
        
        function updateDate(index) {
            index = parseInt(index);
            currentImageIndex = index;
            const data = dateData.find(item => item.index === index) || dateData[0];
            
            // Обновляем дату и уровень CO₂
            document.getElementById('dateValue').textContent = `${data.month} ${data.year}`;
            document.getElementById('co2Value').textContent = `Уровень CO₂: ${data.co2} ppm`;
            document.getElementById('changeFromStart').textContent = 
                `Δ с 2002 года: +${(data.co2 - startCO2).toFixed(1)} ppm`;
            
            // Если изображение уже в кэше
            if (imageCache[index]) {
                const imgElement = document.getElementById('co2Image');
                imgElement.style.opacity = '0';
                
                setTimeout(() => {
                    imgElement.src = imageCache[index].src;
                    imgElement.style.opacity = '1';
                }, 50);
            } else {
                // Если изображение еще не загружено (например, при быстром переключении)
                const img = new Image();
                img.src = data.imgPath;
                
                img.onload = () => {
                    imageCache[index] = img;
                    if (currentImageIndex === index) { // Проверяем, что ползунок не переместился дальше
                        const imgElement = document.getElementById('co2Image');
                        imgElement.style.opacity = '0';
                        
                        setTimeout(() => {
                            imgElement.src = img.src;
                            imgElement.style.opacity = '1';
                        }, 50);
                    }
                };
            }
        }
        
        // Инициализация при загрузке страницы
        window.onload = function() {
            // Начать предзагрузку изображений
            preloadImages();
            
            // Показать первое изображение сразу
            const firstImg = new Image();
            firstImg.src = dateData[0].imgPath;
            firstImg.onload = function() {
                document.getElementById('co2Image').src = this.src;
                document.getElementById('co2Image').style.opacity = '1';
            };
            
            // Инициализация графика
            initChart();
        };
        
        // Данные для графика CO₂ (примерные данные по годам)
        function initChart() {
            const co2HistoricalData = [
                {year: 1958, co2: 315}, {year: 1965, co2: 320}, {year: 1970, co2: 325},
                {year: 1975, co2: 331}, {year: 1980, co2: 338}, {year: 1985, co2: 345},
                {year: 1990, co2: 354}, {year: 1995, co2: 360}, {year: 2000, co2: 369},
                {year: 2005, co2: 379}, {year: 2010, co2: 389}, {year: 2015, co2: 400},
                {year: 2020, co2: 412}, {year: 2023, co2: 419}
            ];
            
            // Создание графика
            const ctx = document.getElementById('co2Chart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: co2HistoricalData.map(item => item.year),
                    datasets: [{
                        label: 'Концентрация CO₂ (ppm)',
                        data: co2HistoricalData.map(item => item.co2),
                        borderColor: '#4fc3f7',
                        backgroundColor: 'rgba(79, 195, 247, 0.2)',
                        borderWidth: 2,
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Глобальная концентрация CO₂ в атмосфере (1958-2023)',
                            color: '#222',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            labels: {
                                color: '#222'
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Год',
                                color: '#222'
                            },
                            ticks: {
                                color: '#222'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Концентрация CO₂ (ppm)',
                                color: '#222'
                            },
                            min: 300,
                            max: 450,
                            ticks: {
                                color: '#222'
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
