<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flood Map Simulation</title>
  <!-- Preconnect для улучшения производительности -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="preconnect" href="https://maps.googleapis.com">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">
  <link rel="dns-prefetch" href="https://maps.googleapis.com">
  
  <style>
    html, body { margin: 0; padding: 0; height: 100%; font-family: Arial, sans-serif; }
    #map { height: 100%; width: 100%; }
    #sliderContainer {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 10px 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      font-family: Arial, sans-serif;
      z-index: 1000;
    }
    #waterLevel { width: 300px; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="sliderContainer">
    Water level: <span id="levelText">0</span> meters
    <input type="range" id="waterLevel" min="0" max="100" value="0" step="1">
  </div>

  <script>
    // Проверяем, есть ли уже загруженный API
    if (!window.google || !window.google.maps) {
      loadGoogleMaps();
    } else {
      initMap();
    }

    function loadGoogleMaps() {
      const script = document.createElement('script');
      script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyAT4ONNU2QJLsazxrIlCqNJgbBC3anVunQ&libraries=visualization,elevation&callback=initMap';
      script.async = true;
      script.defer = true;
      script.onerror = function() {
        console.error('Failed to load Google Maps API');
        document.getElementById('map').innerHTML = '<p style="padding:20px;">Error loading map. Please check your connection.</p>';
      };
      document.head.appendChild(script);
    }

    // Остальной код остается таким же, как в предыдущем исправленном варианте
    let map;
    let floodOverlay;
    let currentWaterLevel = 0;
    let elevationService;
    let lastRequestId = 0;
    let isMapLoaded = false;

    function initMap() {
      try {
        isMapLoaded = true;
        
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 40, lng: 70 },
          zoom: 4,
          mapTypeId: "terrain",
          streetViewControl: false,
          mapTypeControl: false
        });

        // ... остальной код инициализации карты ...
        
      } catch (error) {
        console.error("Map initialization error:", error);
      }
    }

    // ... остальные функции из предыдущего исправленного кода ...
  </script>
</body>
</html>
  </script>
</body>
</html>

