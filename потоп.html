<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Карта затоплений</title>
  <!-- Preconnect для улучшения производительности -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="preconnect" href="https://maps.googleapis.com">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">
  <link rel="dns-prefetch" href="https://maps.googleapis.com">
  
  <style>
    /* === ОБЩИЕ СТИЛИ === */
    html, body { 
      margin: 0; 
      padding: 0; 
      height: 100%; 
      font-family: Arial, sans-serif; 
      color: white;
    }
    
    /* Видео на заднем плане */
    .video-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      object-fit: cover;
      opacity: 0.8;
    }
    
    a {
      text-decoration: none;
    }

    /* === ВЕРХНЕЕ МЕНЮ === */
    .top-bar {
      background-color: rgba(0, 0, 0, 0.7);
      padding: 12px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #333;
      width: 100%;
      box-sizing: border-box;
      backdrop-filter: blur(5px);
      position: fixed;
      top: 0;
      z-index: 1000;
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
    }

    .logo a {
      color: white;
    }

    .main-nav {
      display: flex;
      gap: 30px;
    }

    .main-nav a {
      font-size: 16px;
      color: white;
      font-weight: bold;
    }

    /* === ПОДМЕНЮ === */
    .submenu {
      background: rgba(34, 34, 34, 0.7);
      display: flex;
      justify-content: center;
      padding: 12px 0;
      gap: 30px;
      border-bottom: 1px solid #333;
      width: 100%;
      backdrop-filter: blur(5px);
      position: fixed;
      top: 60px;
      z-index: 1000;
    }

    .submenu a {
      font-size: 16px;
      font-weight: bold;
      color: white;
    }

    /* === КАРТА === */
    #map { 
      height: 100%; 
      width: 100%; 
      position: absolute;
      top: 0;
      left: 0;
    }
    
    /* === КОНТЕЙНЕР КАРТЫ === */
    .map-container {
      position: absolute;
      top: 120px;
      bottom: 0;
      left: 0;
      right: 0;
    }
  </style>
</head>
<body>

  <!-- Видео на заднем плане -->
  <video class="video-background" autoplay muted loop>
    <source src="https://cdn.pixabay.com/video/2024/12/24/248452_large.mp4" type="video/mp4">
  </video>

  <!-- Верхняя панель -->
  <div class="top-bar">
    <div class="logo"><a href="index.html">Главная</a></div>
    <nav class="main-nav">
      <a href="primer.html">Карта</a>
      <a href="primer.html">Диаграммы</a>
      <a href="primer.html">Источники</a>
    </nav>
  </div>

  <!-- Подменю -->
  <nav class="submenu">
    <a href="ПОТЕПЛ.html">Глобальное потепление</a>
    <a href="море.html">Уровень моря</a>
    <a href="тепл море.html">Потепление океана</a>
    <a href="co2.html">Углекислый газ</a>
    <a href="лед.html">Ледяные щиты</a>
  </nav>

  <!-- Контейнер карты -->
  <div class="map-container">
    <div id="map"></div>
  </div>

  <script>
    // Проверяем, есть ли уже загруженный API
    if (!window.google || !window.google.maps) {
      loadGoogleMaps();
    } else {
      initMap();
    }

    function loadGoogleMaps() {
      const script = document.createElement('script');
      script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyAT4ONNU2QJLsazxrIlCqNJgbBC3anVunQ&libraries=visualization,elevation&callback=initMap';
      script.async = true;
      script.defer = true;
      script.onerror = function() {
        console.error('Failed to load Google Maps API');
        document.getElementById('map').innerHTML = '<p style="padding:20px;color:white;">Error loading map. Please check your connection.</p>';
      };
      document.head.appendChild(script);
    }

    let map;
    let floodOverlay;
    let currentWaterLevel = 0;
    let elevationService;
    let lastRequestId = 0;
    let isMapLoaded = false;

    function initMap() {
      try {
        isMapLoaded = true;
        
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 40, lng: 70 },
          zoom: 4,
          mapTypeId: "terrain",
          streetViewControl: false,
          mapTypeControl: false
        });

        elevationService = new google.maps.ElevationService();
        
      } catch (error) {
        console.error("Map initialization error:", error);
      }
    }
  </script>
</body>
</html>
